services:
  rupan-api:
    build: ./rupan-api
    container_name: rupan-api
    restart: unless-stopped
    ports:
      - "9000:9000"
    networks:
      - homelab_default
  homelab-api:
    build: ./homelab-api
    container_name: homelab-api
    restart: unless-stopped
    ports:
      - "9200:9200"
    volumes:
      - ../..:/repo
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - API_KEY=${API_KEY}
      - PROMETHEUS_URL=http://prometheus:9090
      - PROM_INSTANCE=host.docker.internal:9100
      - DEPLOY_SCRIPT=/repo/scripts/deploy.sh
      - REPO_ROOT=/repo
    networks:
      - homelab_default

networks:
  homelab_default:
    external: true
